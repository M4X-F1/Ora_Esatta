<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ora esatta – Digitale + Analogico + Geolocalizzazione</title>
  <style>
    /* Reset di base e font leggibile */
    :root {
      --bg: #0f172a;        /* sfondo scuro (slate-900) */
      --card: #111827;      /* box scuro (gray-900) */
      --text: #e5e7eb;      /* testo chiaro (gray-200) */
      --accent: #60a5fa;    /* blu per dettagli */
      --accent-2: #f59e0b;  /* arancio per secondi */
      --muted: #94a3b8;     /* grigio per tacche e cornici */
      --shadow: 0 8px 20px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 800px at 50% 30%, #111827 0%, #0f172a 60%, #0b1020 100%);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    /* Layout principale */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-rows: auto auto auto 1fr auto;
      gap: 24px;
      min-height: 100vh;
      align-items: start;
    }

    header h1 {
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    header p {
      margin: 6px 0 0;
      color: var(--muted);
    }

    /* Sezione informazioni geografiche */
    .geo-info {
      background: linear-gradient(180deg, #101827 0%, #0c1424 100%);
      border: 1px solid #1f2937;
      border-radius: 14px;
      padding: 16px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }
    .geo-item {
      display: flex;
      flex-direction: column;
    }
    .geo-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .geo-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
    }
    .geo-button {
      background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 10px 16px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    .geo-button:hover {
      background: linear-gradient(180deg, #2563eb 0%, #1e40af 100%);
      transform: translateY(-2px);
    }
    .geo-button:active {
      transform: translateY(0);
    }
    .status {
      font-size: 13px;
      color: var(--muted);
      grid-column: 1 / -1;
    }

    /* Sezione ora digitale (Ore/Minuti/Secondi) */
    .digital {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    .slot {
      background: linear-gradient(180deg, #101827 0%, #0c1424 100%);
      border: 1px solid #1f2937;
      border-radius: 14px;
      padding: 14px 16px;
      box-shadow: var(--shadow);
    }
    .slot-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .slot-value {
      font-size: clamp(28px, 6vw, 52px);
      font-weight: 700;
      line-height: 1;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    .slot-unit {
      font-size: 14px;
      color: var(--muted);
    }

    /* Wrapper dell'orologio analogico */
    .clock-wrapper {
      display: grid;
      place-items: center;
      padding: 16px;
    }

    /* Orologio analogico */
    .clock {
      position: relative;
      width: min(72vw, 380px);
      height: min(72vw, 380px);
      border-radius: 50%;
      background:
        radial-gradient(ellipse at center, #0c1424 0%, #0b1020 60%, #091020 100%),
        conic-gradient(from 0deg, rgba(148,163,184,0.08) 0 360deg);
      border: 2px solid #1f2937;
      box-shadow: var(--shadow);
    }

    .clock::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      border: 1px dashed rgba(148,163,184,0.2);
    }

    .mark {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 4px;
      height: 16%;
      background: linear-gradient(180deg, #94a3b8 0%, transparent 80%);
      transform-origin: center calc(100% - 8px);
      border-radius: 2px;
      opacity: 0.9;
    }

    .tick {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 2px;
      height: 12%;
      background: linear-gradient(180deg, rgba(148,163,184,0.6) 0%, transparent 80%);
      transform-origin: center calc(100% - 6px);
      border-radius: 1px;
      opacity: 0.6;
    }

    .hub {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 14px;
      height: 14px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background: #e5e7eb;
      box-shadow: 0 0 0 4px #0c1424, 0 0 0 6px #1f2937;
    }

    .hand {
      position: absolute;
      left: 50%;
      top: 50%;
      transform-origin: center 90%;
      transform: translate(-50%, -90%) rotate(0deg);
      border-radius: 6px;
      transition: transform 0.1s linear;
      will-change: transform;
    }
    .hand.hour {
      width: 8px;
      height: 30%;
      background: #cbd5e1;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }
    .hand.minute {
      width: 6px;
      height: 40%;
      background: #93c5fd;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }
    .hand.second {
      width: 3px;
      height: 46%;
      background: var(--accent-2);
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }
    .second-tail {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 2px;
      height: 18%;
      background: var(--accent-2);
      transform-origin: center 10%;
      transform: translate(-50%, -10%) rotate(0deg);
      border-radius: 2px;
      opacity: 0.9;
    }

    /* Footer */
    footer {
      margin-top: 8px;
      padding-top: 12px;
      border-top: 1px solid #1f2937;
      color: var(--muted);
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }
    .brand {
      font-weight: 600;
      color: var(--text);
    }

    :focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <main class="container" aria-label="Orologio digitale e analogico con geolocalizzazione">
    <header>
      <h1>Ora Esatta</h1>
      <p>Visualizza l'ora locale in base alla tua posizione geografica</p>
    </header>

    <!-- Sezione geolocalizzazione -->
    <section class="geo-info" aria-label="Informazioni geografiche">
      <div class="geo-item">
        <div class="geo-label">Fuso Orario</div>
        <div class="geo-value" id="timezone">UTC</div>
      </div>
      <div class="geo-item">
        <div class="geo-label">Città</div>
        <div class="geo-value" id="city">—</div>
      </div>
      <div class="geo-item">
        <div class="geo-label">Coordinate</div>
        <div class="geo-value" id="coords">—</div>
      </div>
      <button class="geo-button" onclick="detectLocation()">Rileva Posizione</button>
      <div class="status" id="status">Caricamento informazioni geografiche...</div>
    </section>

    <!-- Sezione digitale -->
    <section class="digital" aria-label="Ora digitale">
      <div class="slot" aria-live="polite" aria-atomic="true">
        <div class="slot-label">Ore</div>
        <div class="slot-value">
          <span id="hours">00</span>
          <span class="slot-unit">h</span>
        </div>
      </div>
      <div class="slot" aria-live="polite" aria-atomic="true">
        <div class="slot-label">Minuti</div>
        <div class="slot-value">
          <span id="minutes">00</span>
          <span class="slot-unit">m</span>
        </div>
      </div>
      <div class="slot" aria-live="polite" aria-atomic="true">
        <div class="slot-label">Secondi</div>
        <div class="slot-value">
          <span id="seconds">00</span>
          <span class="slot-unit">s</span>
        </div>
      </div>
    </section>

    <!-- Orologio analogico -->
    <section class="clock-wrapper" aria-label="Orologio analogico">
      <div class="clock" role="img" aria-label="Orologio analogico con lancette di ore, minuti e secondi">
        <div class="hand hour" id="hand-hour" aria-hidden="true"></div>
        <div class="hand minute" id="hand-minute" aria-hidden="true"></div>
        <div class="hand second" id="hand-second" aria-hidden="true"></div>
        <div class="second-tail" id="second-tail" aria-hidden="true"></div>
        <div class="hub" aria-hidden="true"></div>
      </div>
    </section>

    <footer>
      <div class="brand">Designed by L.C. – 5^IT</div>
    </footer>
  </main>

  <script>
    const pad2 = (n) => String(n).padStart(2, "0");

    const elHours = document.getElementById("hours");
    const elMinutes = document.getElementById("minutes");
    const elSeconds = document.getElementById("seconds");

    const handHour = document.getElementById("hand-hour");
    const handMinute = document.getElementById("hand-minute");
    const handSecond = document.getElementById("hand-second");
    const secondTail = document.getElementById("second-tail");
    const clock = document.querySelector(".clock");

    const elTimezone = document.getElementById("timezone");
    const elCity = document.getElementById("city");
    const elCoords = document.getElementById("coords");
    const elStatus = document.getElementById("status");

    let userTimezone = null;

    // Genera tacche orologio
    (function generateMarks() {
      for (let i = 0; i < 12; i++) {
        const mark = document.createElement("div");
        mark.className = "mark";
        mark.style.transform = `translate(-50%, -90%) rotate(${i * 30}deg)`;
        clock.appendChild(mark);
      }
      for (let i = 0; i < 60; i++) {
        if (i % 5 === 0) continue;
        const tick = document.createElement("div");
        tick.className = "tick";
        tick.style.transform = `translate(-50%, -90%) rotate(${i * 6}deg)`;
        clock.appendChild(tick);
      }
    })();

    // Rileva posizione geografica
    async function detectLocation() {
      elStatus.textContent = "Rilevamento in corso...";
      
      if (!navigator.geolocation) {
        elStatus.textContent = "Geolocalizzazione non disponibile su questo browser.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;
          elCoords.textContent = `${latitude.toFixed(2)}°, ${longitude.toFixed(2)}°`;
          
          try {
            // Usa API open-source per reverse geocoding e timezone
            const response = await fetch(
              `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
            );
            const data = await response.json();
            
            const city = data.address?.city || data.address?.town || data.address?.village || "Sconosciuta";
            elCity.textContent = city;

            // Calcola il fuso orario basato sulla longitudine (approssimazione)
            const offset = Math.round(longitude / 15);
            const tzString = offset >= 0 ? `UTC+${offset}` : `UTC${offset}`;
            elTimezone.textContent = tzString;
            userTimezone = offset;

            elStatus.textContent = `✓ Posizione rilevata con successo`;
          } catch (err) {
            elStatus.textContent = "Errore nel rilevamento della città. Fuso calcolato dalla longitudine.";
            const offset = Math.round(longitude / 15);
            const tzString = offset >= 0 ? `UTC+${offset}` : `UTC${offset}`;
            elTimezone.textContent = tzString;
            userTimezone = offset;
          }
        },
        (error) => {
          elStatus.textContent = `Permesso negato o errore: ${error.message}. Usa l'ora locale del sistema.`;
        }
      );
    }

    // Aggiorna orologio
    function updateClock() {
      const now = new Date();
      
      let h = now.getHours();
      let m = now.getMinutes();
      let s = now.getSeconds();

      // Se è stato rilevato un fuso orario, regola l'ora
      if (userTimezone !== null) {
        const utcHours = now.getUTCHours();
        const utcMinutes = now.getUTCMinutes();
        const utcSeconds = now.getUTCSeconds();
        
        const totalSeconds = utcHours * 3600 + utcMinutes * 60 + utcSeconds + (userTimezone * 3600);
        h = Math.floor((totalSeconds % 86400) / 3600);
        m = Math.floor((totalSeconds % 3600) / 60);
        s = totalSeconds % 60;
      }

      elHours.textContent = pad2(h);
      elMinutes.textContent = pad2(m);
      elSeconds.textContent = pad2(s);

      const secDeg = s * 6;
      const minDeg = m * 6 + s * 0.1;
      const hourDeg = (h % 12) * 30 + m * 0.5 + s * (0.5 / 60);

      handSecond.style.transform = `translate(-50%, -90%) rotate(${secDeg}deg)`;
      secondTail.style.transform = `translate(-50%, -10%) rotate(${secDeg}deg)`;
      handMinute.style.transform = `translate(-50%, -90%) rotate(${minDeg}deg)`;
      handHour.style.transform = `translate(-50%, -90%) rotate(${hourDeg}deg)`;
    }

    // Inizializza
    detectLocation();
    updateClock();
    setInterval(updateClock, 1000);
  </script>
</body>
</html>